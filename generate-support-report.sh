#!/bin/bash

# Zama Destek Ä°Ã§in Rapor OluÅŸturma Scripti
# Bu script tÃ¼m gerekli bilgileri toplar ve bir rapor dosyasÄ± oluÅŸturur

OUTPUT_FILE="zama-support-report-$(date +%Y%m%d-%H%M%S).txt"

echo "ðŸ” Zama Destek Raporu OluÅŸturuluyor..."
echo ""

{
  echo "============================================================"
  echo "ZAMA FHE DESTEK RAPORU"
  echo "============================================================"
  echo ""
  echo "Tarih: $(date)"
  echo "Proje: ChronoMessage / SealedMessage"
  echo ""

  echo "============================================================"
  echo "1. SÃ–ZLEÅžME BÄ°LGÄ°LERÄ°"
  echo "============================================================"
  echo ""
  echo "Network: Sepolia Testnet (Chain ID: 11155111)"
  echo ""
  echo "Deploy Edilen SÃ¶zleÅŸmeler:"
  echo "  - ConfidentialMessage: 0x38756CCb09EE1719089F370a8386a772a8F7B5cf"
  echo "  - ChronoMessageZama:   0x65016d7E35EC1830d599991d82381bf03eEC2987"
  echo ""
  echo "Deployer Address: 0xF6D39Dda8997407110264acEc6a24345834cB639"
  echo ""
  echo "Etherscan Links:"
  echo "  https://sepolia.etherscan.io/address/0x38756CCb09EE1719089F370a8386a772a8F7B5cf"
  echo "  https://sepolia.etherscan.io/address/0x65016d7E35EC1830d599991d82381bf03eEC2987"
  echo ""

  echo "============================================================"
  echo "2. SORUN TANIMI"
  echo "============================================================"
  echo ""
  echo "âŒ SORUN: FHE.fromExternal() Ã§aÄŸrÄ±larÄ± revert ediyor"
  echo ""
  echo "Detaylar:"
  echo "  - SDK ile ÅŸifreleme baÅŸarÄ±lÄ±"
  echo "  - Handle ve inputProof formatlarÄ± doÄŸru"
  echo "  - Gas estimation sÄ±rasÄ±nda revert oluÅŸuyor"
  echo "  - Error: execution reverted (sebep belirtilmiyor)"
  echo ""
  echo "Test Edilen Senaryolar:"
  echo "  1. âœ… SDK baÅŸlatma - BaÅŸarÄ±lÄ±"
  echo "  2. âœ… FHE instance oluÅŸturma - BaÅŸarÄ±lÄ±"
  echo "  3. âœ… createEncryptedInput().encrypt() - BaÅŸarÄ±lÄ±"
  echo "  4. âŒ sendMessage gas estimation - REVERT"
  echo "  5. âŒ EmelMarket cWETH wrap() - REVERT (karÅŸÄ±laÅŸtÄ±rma iÃ§in)"
  echo ""

  echo "============================================================"
  echo "3. SDK KONFÄ°GÃœRASYONU"
  echo "============================================================"
  echo ""
  echo "Package: @zama-fhe/relayer-sdk v0.2.0"
  echo ""
  echo "SepoliaConfig:"
  echo "  aclContractAddress:            0x687820221192C5B662b25367F70076A37bc79b6c"
  echo "  kmsContractAddress:            0x1364cBBf2cDF5032C47d8226a6f6FBD2AFCDacAC"
  echo "  inputVerifierContractAddress:  0xbc91f3daD1A5F19F8390c400196e58073B6a0BC4"
  echo "  gatewayChainId:                55815"
  echo "  relayerUrl:                    https://relayer.testnet.zama.cloud"
  echo "  network:                       https://eth-sepolia.public.blastapi.io"
  echo ""

  echo "============================================================"
  echo "4. SÃ–ZLEÅžME KONFÄ°GÃœRASYONU"
  echo "============================================================"
  echo ""
  echo "Solidity Version: 0.8.24"
  echo "FHEVM Library: @fhevm/solidity v0.9.0-1"
  echo ""
  echo "ZamaConfig (contracts kullanÄ±yor):"
  echo "  ACLAddress:            0x687820221192C5B662b25367F70076A37bc79b6c âœ…"
  echo "  CoprocessorAddress:    0x848B0066793BcC60346Da1F49049357399B8D595"
  echo "  KMSVerifierAddress:    0x1364cBBf2cDF5032C47d8226a6f6FBD2AFCDacAC âœ…"
  echo "  Protocol ID:           10001 âœ…"
  echo ""
  echo "Constructor: extends SepoliaConfig"
  echo ""

  echo "============================================================"
  echo "5. TEST SONUÃ‡LARI"
  echo "============================================================"
  echo ""
  echo "Ã‡alÄ±ÅŸtÄ±rÄ±lan Script: scripts/verify-zama-config.ts"
  echo ""
  echo "SonuÃ§lar:"
  echo "  âœ… FHE Instance oluÅŸturuldu"
  echo "  âœ… Public Key alÄ±ndÄ± (33018 bytes)"
  echo "  âœ… SÃ¶zleÅŸme eriÅŸilebilir"
  echo "  âœ… Protocol ID doÄŸru (10001)"
  echo "  âœ… Åžifreleme baÅŸarÄ±lÄ±"
  echo "  âœ… ACL sÃ¶zleÅŸmesi deploy edilmiÅŸ"
  echo "  âœ… Relayer eriÅŸilebilir"
  echo "  âŒ sendMessage gas estimation revert"
  echo ""
  echo "Ã–rnek Handle: 0x1e3c63efa44a862ae503c460fc1e2982d2195493d2000000000000aa36a70500"
  echo "Handle Size: 32 bytes âœ…"
  echo "Proof Size: 100 bytes âœ…"
  echo ""

  echo "============================================================"
  echo "6. GEÃ‡ERLÄ°LÄ°K KONTROLÃœ"
  echo "============================================================"
  echo ""
  echo "ACL/KMS Adres KarÅŸÄ±laÅŸtÄ±rmasÄ±:"
  echo "  SDK ACL:       0x687820221192C5B662b25367F70076A37bc79b6c"
  echo "  Contract ACL:  0x687820221192C5B662b25367F70076A37bc79b6c"
  echo "  Durum:         âœ… EÅžLEÅžIYOR"
  echo ""
  echo "  SDK KMS:       0x1364cBBf2cDF5032C47d8226a6f6FBD2AFCDacAC"
  echo "  Contract KMS:  0x1364cBBf2cDF5032C47d8226a6f6FBD2AFCDacAC"
  echo "  Durum:         âœ… EÅžLEÅžIYOR"
  echo ""

  echo "============================================================"
  echo "7. TAHMÄ°NÄ° SORUN NEDENÄ°"
  echo "============================================================"
  echo ""
  echo "OlasÄ± Nedenler:"
  echo ""
  echo "1. âš ï¸  SÃ–ZLEÅžME KAYIT EKSÄ°KLÄ°ÄžÄ°"
  echo "   SÃ¶zleÅŸmemiz Zama relayer tarafÄ±ndan tanÄ±nmÄ±yor olabilir."
  echo "   Relayer'Ä±n ACL/InputVerifier listesine eklenmemiÅŸ olabilir."
  echo ""
  echo "2. âš ï¸  INPUT PROOF DOÄžRULAMA SORUNU"
  echo "   createEncryptedInput(contractAddress, userAddress) Ã§aÄŸrÄ±sÄ±"
  echo "   doÄŸru parametrelerle yapÄ±lÄ±yor ancak proof doÄŸrulanamÄ±yor."
  echo ""
  echo "3. âš ï¸  GATEWAY BAÄžLANTI SORUNU"
  echo "   Gateway Chain ID: 55815"
  echo "   SÃ¶zleÅŸme bu gateway ile iletiÅŸim kuramÄ±yor olabilir."
  echo ""

  echo "============================================================"
  echo "8. TALEP EDÄ°LEN DESTEK"
  echo "============================================================"
  echo ""
  echo "â“ Sorular:"
  echo ""
  echo "1. SÃ¶zleÅŸmemiz relayer'a kayÄ±tlÄ± mÄ±?"
  echo "   - Contract: 0x38756CCb09EE1719089F370a8386a772a8F7B5cf"
  echo ""
  echo "2. ACL izinleri verilmiÅŸ mi?"
  echo "   - Deployer: 0xF6D39Dda8997407110264acEc6a24345834cB639"
  echo ""
  echo "3. Input verifier sÃ¶zleÅŸmeyi biliyor mu?"
  echo "   - InputVerifier: 0xbc91f3daD1A5F19F8390c400196e58073B6a0BC4"
  echo ""
  echo "4. SÃ¶zleÅŸmeyi manuel olarak kaydetmemiz gerekiyor mu?"
  echo ""
  echo "5. Ek bir kurulum/konfigÃ¼rasyon adÄ±mÄ± var mÄ±?"
  echo ""

  echo "============================================================"
  echo "9. Ä°LETÄ°ÅžÄ°M BÄ°LGÄ°LERÄ°"
  echo "============================================================"
  echo ""
  echo "Proje: ChronoMessage (Zaman Kilitli FHE MesajlaÅŸma)"
  echo "GitHub: (varsa eklenebilir)"
  echo ""
  echo "Deployer Email: (isteÄŸe baÄŸlÄ±)"
  echo "Discord Username: (isteÄŸe baÄŸlÄ±)"
  echo ""

  echo "============================================================"
  echo "10. EK DÃ–KÃœMANLAR"
  echo "============================================================"
  echo ""
  echo "Proje iÃ§inde mevcut dÃ¶kÃ¼manlar:"
  echo "  - ZAMA_TROUBLESHOOTING.md"
  echo "  - ZAMA_INTEGRATION.md"
  echo "  - scripts/verify-zama-config.ts"
  echo "  - scripts/test-emelmarket-encryption.ts"
  echo ""
  echo "Bu dosyalarÄ± da inceleyebilirsiniz."
  echo ""

  echo "============================================================"
  echo "RAPOR SONU"
  echo "============================================================"
  echo ""
  echo "Bu rapor otomatik olarak oluÅŸturulmuÅŸtur."
  echo "Script: generate-support-report.sh"
  echo "Tarih: $(date)"
  echo ""

} > "$OUTPUT_FILE"

echo "âœ… Rapor oluÅŸturuldu: $OUTPUT_FILE"
echo ""
echo "ðŸ“§ Bu raporu Zama destek ekibi ile paylaÅŸabilirsiniz:"
echo "   - Discord: https://discord.gg/zama"
echo "   - GitHub: https://github.com/zama-ai/fhevm/issues"
echo ""
echo "ðŸ“‹ Rapor iÃ§eriÄŸi:"
cat "$OUTPUT_FILE"
